<!DOCTYPE html>
<html>
<head>
    <title>Interactive Folium Map</title>
    <meta charset="utf-8">
    <style>
        #map { height: 600px; width: 100%; }
    </style>
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <h2>üìç ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î: ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å Plus Code (OLC)</h2>

    <form method="POST" style="margin-bottom: 10px;">
        <input type="text" name="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà" required>
        <br><br>
        <input type="text" name="olc" placeholder="Plus Code (OLC)">
        <br><br>
        <input type="number" step="any" name="lat" id="lat" placeholder="‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î">
        <input type="number" step="any" name="lng" id="lng" placeholder="‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î">
        <br><br>
        <button type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏∏‡∏î</button>
    </form>

    <div id="map"></div>

    <script>
        const map = L.map('map').setView([13.7563, 100.5018], 12);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        let marker;

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
        map.on('click', function(e) {
            const { lat, lng } = e.latlng;
            document.getElementById('lat').value = lat.toFixed(6);
            document.getElementById('lng').value = lng.toFixed(6);

            if (marker) {
                map.removeLayer(marker);
            }

            marker = L.marker([lat, lng]).addTo(map)
                     .bindPopup('üìç ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ô‡∏µ‡πâ').openPopup();
        });

        // (optional) preload ‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏≤‡∏Å map.html
        fetch("{{ url_for('static', filename='map.html') }}")
            .then(res => res.text())
            .then(html => {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.srcdoc = html;
                document.body.appendChild(iframe);
            });
    </script>
</body>
</html>
