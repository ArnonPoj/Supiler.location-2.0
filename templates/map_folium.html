<!DOCTYPE html>
<html>
<head>
    <title>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏° OLC</title>
    <meta charset="utf-8" />
    <style>
        #map {
            width: 100%;
            height: 90vh;
        }
        #olc-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
        }
        #olc-form {
            position: fixed;
            bottom: 80px;
            right: 30px;
            z-index: 9999;
            background: white;
            padding: 15px;
            box-shadow: 0 0 8px rgba(0,0,0,0.3);
            border-radius: 8px;
            display: none;
            width: 280px;
        }
        #olc-form input, #olc-form textarea {
            width: 100%;
            margin-bottom: 8px;
            padding: 6px;
            box-sizing: border-box;
            font-size: 14px;
        }
        #olc-form button {
            margin-right: 8px;
            padding: 6px 12px;
            font-size: 14px;
        }
    </style>
</head>
<body>

<h2 style="text-align:center;">üìç ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏° OLC ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏±‡∏û</h2>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏° -->
<div id="olc-button">
    <button onclick="toggleOlcForm()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏∏‡∏î‡∏î‡πâ‡∏ß‡∏¢ OLC</button>
</div>

<!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏™‡πà OLC + ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
<div id="olc-form">
    <input type="text" id="olc-code" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Plus Code (OLC) ‡πÄ‡∏ä‡πà‡∏ô 7P4M+2C" />
    <input type="text" id="title" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡∏±‡∏û" />
    <textarea id="address" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
    <textarea id="detail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
    <button onclick="submitOlcMarker()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏∏‡∏î</button>
    <button onclick="toggleOlcForm()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</div>

<!-- ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà Folium -->
<div id="map">{{ map_html|safe }}</div>

<script>
function toggleOlcForm() {
    const f = document.getElementById('olc-form');
    f.style.display = (f.style.display === 'none' || f.style.display === '') ? 'block' : 'none';
}

function submitOlcMarker() {
    const olc = document.getElementById('olc-code').value.trim();
    const title = document.getElementById('title').value.trim();
    const address = document.getElementById('address').value.trim();
    const detail = document.getElementById('detail').value.trim();

    if (!olc || !title) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å OLC ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡∏±‡∏û');
        return;
    }

    fetch('/add_marker', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ olc, title, address, detail })
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) alert(data.error);
        else {
            alert(data.message);
            location.reload();
        }
    });
}
</script>

</body>
</html>
